<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>parallel-preprocessor: property container</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">parallel-preprocessor
   &#160;<span id="projectnumber">0.3.0.f176d79</span>
   </div>
   <div id="projectbrief">MPI distributive and multithreading massively parallel geometry processor     for large scale CAE and machine learning, by Qingfeng Xia, UKAEA, 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_src_PropertyContainer_Readme.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">property container </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b><a class="el" href="classA.html" title="a dummy class to test property container">A</a> true heterogeneous container in modern C++ based on <code>std::any</code> to mimic dynamic property</b></p>
<h1>The design of this property container</h1>
<h2>type erasure by <code>std::any</code></h2>
<p>This property container relies on c++ RTTI. RTTI runtime cost is low for <code>std::any</code> since typeid is fast, but dynamic_cast&lt;&gt; is slow!</p>
<p>See discussion on the cost of RTTI: <a href="https://stackoverflow.com/questions/579887/how-expensive-is-rtti">https://stackoverflow.com/questions/579887/how-expensive-is-rtti</a> </p><blockquote class="doxtable">
<p>In GCC's preferred ABI, a class vtable always holds a pointer to a per-type RTTI structure, though it might not be used. So a typeid() call itself should only cost as much as any other vtable lookup (the same as calling a virtual member function), and RTTI support shouldn't use any extra space for each object. </p>
</blockquote>
<p>For OS without C++17 compiler, <code>boost::any</code> might be used instead. It is possible to mix <code>boost::any</code> and <code>std::any</code>, tested on ubnutu 18.04, libboost 1.65.</p>
<h2>thread safety (currently not safe)</h2>
<p>This property container is not thread-safe, because STL container <code>std::map</code> is used. By replacing the internal has container with Intel Thread Build Blocks(TBB)'s concurrent hash container type, thread-safe property container might be achieved. It is not yet testec.</p>
<h2>json serialization</h2>
<p>json for basic types (as already supported by nlohmann json library) are supported out of box with default json serialization, more user types might be supported by ADL. User serializer and deserializer can be specified when <code>setSerializable(key, value, serializer_function)</code>.</p>
<p>Note: this feature is under design, yet fully tested. Also consider save data into the <code>DataStorage</code> class.</p>
<h2>Other example of property container design</h2>
<ul>
<li>Dynamic Property Maps of boost</li>
<li>PropertyContainer of FreeCAD: support transaction, serialization, etc</li>
<li>vtkInformation: <a href="https://vtk.org/doc/nightly/html/classvtkInformation.html">https://vtk.org/doc/nightly/html/classvtkInformation.html</a></li>
<li>json.hpp: the supported data type are very limited (literal type supported by js)</li>
</ul>
<p>If an advanced container is needed, such as transaction control, try to use a full-fledged framework like FreeCAD's <code>PropertyContainer</code></p>
<h1>compile and test</h1>
<h2>test without cmake</h2>
<p>first of all, download Catch2 into this folder,</p>
<div class="fragment"><div class="line">- on posix</div>
<div class="line"> </div>
<div class="line"> g++ -std=c++17 -Wall -I./Catch2/single_include -o PropertyContainerTest PropertyContainerTest.cpp &amp;&amp;</div>
<div class="line"> ./PropertyContainerTest --success</div>
<div class="line"> </div>
<div class="line">- on windows</div>
<div class="line"> cl -EHsc -I%CATCH_SINGLE_INCLUDE% PropertyContainerTest.cpp PropertyContainerTest.obj &amp;&amp;</div>
<div class="line"> ./PropertyContainerTest --success</div>
</div><!-- fragment --><h2>test with cmake</h2>
<p>CMakeLists.txt is ready to use, except that Catch2 needs to config/download. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
